
TSC = ./node_modules/.bin/tsc

all: test


test: \
	FORCE \
	test_bash \
	test_sh \
	test_zsh \
	test_makefile \
	test_typescript


# Bash/sh/zsh
test_bash:
	@echo "Testing Bash..."
	@bash test/test.sh | bash test/validate-output.bash
	@bash test/test-pipe.sh | bash test/validate-output.bash

test_sh:
	@echo "Testing sh..."
	@sh test/test.sh | bash test/validate-output.bash
	@sh test/test-pipe.sh | bash test/validate-output.bash

test_zsh:
	@echo "Testing zsh..."
	@zsh test/test.sh | bash test/validate-output.bash
	@zsh test/test-pipe.sh | bash test/validate-output.bash

# Makefile
test_makefile:
	@echo "Testing Makefile..."
	@make --no-print-directory -C test | bash test/validate-output.bash

# TypeScript & JavaScript
test_typescript: src/unlog.js test/test.js
	@echo "Testing TypeScript/JavaScript..."
	@node test/test.js | bash test/validate-output.bash

%.js: %.ts
	$(TSC) $< --strict --declaration

FORCE:

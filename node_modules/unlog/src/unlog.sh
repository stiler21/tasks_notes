#!/bin/bash

echo_timestamped () {
  datestr=`date +'%Y-%m-%d %H:%M:%S'`
  echo -e "$datestr $1"
}

log_sep=" | "

unlog_messages () {
  mode=$1
  msg=$2
  if test $mode = "log"; then
    echo_timestamped "LOG$log_sep$msg"
  fi
  if test $mode = "warn"; then
    echo_timestamped "WRN$log_sep$msg"
  fi
  if test $mode = "error"; then
    echo_timestamped "ERR$log_sep$msg"
  fi
}

unlog () {
  if test $# -lt 1; then
    echo "Expecting log level."
    exit -1
  fi
  mode=$1

  if test $# -eq 1; then
    # Read from stdin
    while read REPLY; do
      unlog_messages $mode "$REPLY"
    done
  else
    unlog_messages $mode "$2"
  fi
}


log () {
  unlog log "$@"
}

warn () {
  unlog warn "$@"
}

error () {
  unlog error "$@"
}
